<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPX Projects</title>
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <script src="https://unpkg.com/hyperscript.org@0.9.8"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">GPX Projects</h1>
        
        <div id="login-section" class="mb-8">
            <button hx-get="https://gpx.onrender.com/login" 
                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Login with GitHub
            </button>
        </div>
        
        <div id="projects-section" class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Your Projects</h2>
            <div id="projects" hx-get="https://gpx.onrender.com/projects" hx-trigger="load">
                Loading projects...
            </div>
        </div>
        
        <div id="project-items-section" class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Project Items</h2>
            <select id="project-selector" class="mb-4 p-2 border rounded"
                    _="on change set projectId to my.value
                                then fetch items from server">
                <option value="">Select a project</option>
            </select>
            <div id="project-items">
                Select a project to view items
            </div>
        </div>
        
        <div id="add-item-section" class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Add New Item</h2>
            <form hx-post="https://gpx.onrender.com/project/{projectId}/item"
                  hx-target="#project-items"
                  hx-swap="beforeend"
                  _="on submit set my.projectId to #project-selector.value">
                <input type="text" name="note" placeholder="Enter item note" 
                       class="p-2 border rounded mr-2" required>
                <button type="submit" 
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                    Add Item
                </button>
            </form>
        </div>
    </div>

    <script type="text/hyperscript">
        def fetch items from server
            set #project-items.innerHTML to "Loading items..."
            fetch(`https://gpx.onrender.com/project/${projectId}/items`)
                then put the result into #project-items
        end

        on htmx:afterOnLoad(#projects)
            for project in #projects div
                get the textContent of the h3 in project
                set projectName to it
                get the id of project
                set projectId to it
                add an option with projectName and value projectId to #project-selector
            end
        end
    </script>
</body>
</html>
